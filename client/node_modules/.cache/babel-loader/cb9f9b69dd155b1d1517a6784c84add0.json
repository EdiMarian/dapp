{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as React from'react';import BigNumber from'bignumber.js';import{Formik}from'formik';import{string,object}from'yup';import{Submit}from'components/Action';import{network}from'config';import{useGlobalContext}from'context';import{denominated}from'helpers/denominate';import modifiable from'helpers/modifiable';import{nominateValToHex}from'helpers/nominate';import useTransaction from'helpers/useTransaction';import styles from'./styles.module.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ChangeDelegationCap=function ChangeDelegationCap(){var _useTransaction=useTransaction(),sendTransaction=_useTransaction.sendTransaction;var _useGlobalContext=useGlobalContext(),contractDetails=_useGlobalContext.contractDetails,totalActiveStake=_useGlobalContext.totalActiveStake;var minimum=denominated(totalActiveStake.data||'',{addCommas:false});var total=denominated(contractDetails.data?contractDetails.data.delegationCap:'',{addCommas:false});var validationSchema=object().shape({amount:string().required('Required').test('minimum',\"Minimum \".concat(minimum,\" \").concat(network.egldLabel,\" or 0 \").concat(network.egldLabel),function(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';return new BigNumber(value).isGreaterThanOrEqualTo(minimum)||value==='0';})});var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return sendTransaction({args:nominateValToHex(data.amount.toString()),type:'modifyTotalDelegationCap',value:'0'});case 3:_context.next=8;break;case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 8:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}));return function onSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:styles.cap,children:/*#__PURE__*/_jsx(Formik,{validationSchema:validationSchema,onSubmit:onSubmit,initialValues:{amount:total},children:function children(_ref2){var errors=_ref2.errors,values=_ref2.values,touched=_ref2.touched,handleChange=_ref2.handleChange,handleBlur=_ref2.handleBlur,handleSubmit=_ref2.handleSubmit;return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.field,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"amount\",children:\"Update Delegation Cap\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.group,children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"amount\",step:\"any\",required:true,autoComplete:\"off\",min:0,className:modifiable('input',[errors.amount&&touched.amount&&'invalid'],styles),value:values.amount,onBlur:handleBlur,onChange:handleChange})}),errors.amount&&touched.amount&&/*#__PURE__*/_jsx(\"span\",{className:styles.error,children:errors.amount})]}),/*#__PURE__*/_jsx(Submit,{close:\"Cancel\",submit:\"Continue\"})]});}})});};export default ChangeDelegationCap;","map":{"version":3,"sources":["/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/src/components/Cards/components/ChangeDelegationCap/index.tsx"],"names":["React","BigNumber","Formik","string","object","Submit","network","useGlobalContext","denominated","modifiable","nominateValToHex","useTransaction","styles","ChangeDelegationCap","sendTransaction","contractDetails","totalActiveStake","minimum","data","addCommas","total","delegationCap","validationSchema","shape","amount","required","test","egldLabel","value","isGreaterThanOrEqualTo","onSubmit","args","toString","type","console","error","cap","errors","values","touched","handleChange","handleBlur","handleSubmit","field","group"],"mappings":"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","sourcesContent":["import * as React from 'react';\n\nimport BigNumber from 'bignumber.js';\n\nimport { Formik } from 'formik';\nimport { string, object } from 'yup';\n\nimport { Submit } from 'components/Action';\nimport { network } from 'config';\nimport { useGlobalContext } from 'context';\nimport { denominated } from 'helpers/denominate';\nimport modifiable from 'helpers/modifiable';\nimport { nominateValToHex } from 'helpers/nominate';\nimport useTransaction from 'helpers/useTransaction';\n\nimport styles from './styles.module.scss';\n\ninterface ActionDataType {\n  amount: string;\n}\n\nconst ChangeDelegationCap: React.FC = () => {\n  const { sendTransaction } = useTransaction();\n  const { contractDetails, totalActiveStake } = useGlobalContext();\n\n  const minimum = denominated(totalActiveStake.data || '', {\n    addCommas: false\n  });\n\n  const total = denominated(\n    contractDetails.data ? contractDetails.data.delegationCap : '',\n    {\n      addCommas: false\n    }\n  );\n\n  const validationSchema = object().shape({\n    amount: string()\n      .required('Required')\n      .test(\n        'minimum',\n        `Minimum ${minimum} ${network.egldLabel} or 0 ${network.egldLabel}`,\n        (value = '') =>\n          new BigNumber(value).isGreaterThanOrEqualTo(minimum) || value === '0'\n      )\n  });\n\n  const onSubmit = async (data: ActionDataType): Promise<void> => {\n    try {\n      await sendTransaction({\n        args: nominateValToHex(data.amount.toString()),\n        type: 'modifyTotalDelegationCap',\n        value: '0'\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  return (\n    <div className={styles.cap}>\n      <Formik\n        validationSchema={validationSchema}\n        onSubmit={onSubmit}\n        initialValues={{\n          amount: total\n        }}\n      >\n        {({\n          errors,\n          values,\n          touched,\n          handleChange,\n          handleBlur,\n          handleSubmit\n        }) => (\n          <form onSubmit={handleSubmit}>\n            <div className={styles.field}>\n              <label htmlFor='amount'>Update Delegation Cap</label>\n\n              <div className={styles.group}>\n                <input\n                  type='number'\n                  name='amount'\n                  step='any'\n                  required={true}\n                  autoComplete='off'\n                  min={0}\n                  className={modifiable(\n                    'input',\n                    [errors.amount && touched.amount && 'invalid'],\n                    styles\n                  )}\n                  value={values.amount}\n                  onBlur={handleBlur}\n                  onChange={handleChange}\n                />\n              </div>\n\n              {errors.amount && touched.amount && (\n                <span className={styles.error}>{errors.amount}</span>\n              )}\n            </div>\n\n            <Submit close='Cancel' submit='Continue' />\n          </form>\n        )}\n      </Formik>\n    </div>\n  );\n};\n\nexport default ChangeDelegationCap;\n"]},"metadata":{},"sourceType":"module"}