{"ast":null,"code":"import _objectSpread from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as React from'react';import{useEffect,useState,Fragment}from'react';import{transactionServices}from'@elrondnetwork/dapp-core';import{faPlus,faServer,faTimes,faCheck,faExternalLinkAlt,faAngleDown}from'@fortawesome/free-solid-svg-icons';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{Dropdown}from'react-bootstrap';import Action from'components/Action';import{network}from'config';import{useGlobalContext}from'context';import modifiable from'helpers/modifiable';import useTransaction from'helpers/useTransaction';import Add from'./components/Add';import styles from'./styles.module.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Nodes=function Nodes(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var _useGlobalContext=useGlobalContext(),nodesNumber=_useGlobalContext.nodesNumber;var _useTransaction=useTransaction(),sendTransaction=_useTransaction.sendTransaction;var _transactionServices$=transactionServices.useGetActiveTransactionsStatus(),success=_transactionServices$.success,hasActiveTransactions=_transactionServices$.hasActiveTransactions;var isLoading=nodesNumber.status==='loading';var variants={staked:{label:'Staked',color:'success',actions:['unStake']},jailed:{label:'Jail',color:'danger',actions:['unJail']},queued:{label:'Queued',color:'warning',actions:['unStake']},unStaked:{label:'UnStaked',color:'warning',actions:['unBond','reStake']},notStaked:{label:'Inactive',color:'warning',actions:['stake','remove']}};var actions=[{key:'unStake',label:'Unstake',callback:function callback(value){return{value:'0',type:'unStakeNodes',args:value};}},{key:'reStake',label:'ReStake',callback:function callback(value){return{value:'0',type:'reStakeUnStakedNodes',args:value};}},{key:'unJail',label:'Unjail',callback:function callback(value){return{value:'2.5',type:'unJailNodes',args:value};}},{key:'unBond',label:'Unbond',callback:function callback(value){return{value:'0',type:'unBondNodes',args:value};}},{key:'stake',label:'Stake',callback:function callback(value){return{value:'0',type:'stakeNodes',args:\"\".concat(value)};}},{key:'remove',label:'Remove',callback:function callback(value){return{value:'0',type:'removeNodes',args:\"\".concat(value)};}}];var onAct=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref){var value,type,args;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:value=_ref.value,type=_ref.type,args=_ref.args;_context.prev=1;_context.next=4;return sendTransaction({args:args,type:type,value:value});case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 9:case\"end\":return _context.stop();}}},_callee,null,[[1,6]]);}));return function onAct(_x){return _ref2.apply(this,arguments);};}();var getNodes=function getNodes(){if(nodesNumber.data&&nodesNumber.data.length>0){var calculateNodes=function calculateNodes(nodes){return nodes.reduce(function(result,value,index,array){if(index%2===0){var _array$slice=array.slice(index,index+2),_array$slice2=_slicedToArray(_array$slice,2),code=_array$slice2[0],status=_array$slice2[1];var item={code:Buffer.from(code,'base64').toString('hex'),status:Buffer.from(status,'base64').toString()};return[].concat(_toConsumableArray(result),[_objectSpread(_objectSpread({},item),{},{status:variants[item.status]})]);}return result;},[]);};setData(calculateNodes(nodesNumber.data));}return function(){return setData([]);};};var refetchNodes=function refetchNodes(){if(success&&hasActiveTransactions&&nodesNumber.data){getNodes();}};useEffect(getNodes,[nodesNumber.data,success]);useEffect(refetchNodes,[hasActiveTransactions,success]);return/*#__PURE__*/_jsxs(\"div\",{className:styles.nodes,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.heading,children:[/*#__PURE__*/_jsx(\"span\",{className:styles.title,children:\"My Nodes\"}),/*#__PURE__*/_jsx(Action,{title:\"Add Nodes\",trigger:/*#__PURE__*/_jsxs(\"div\",{className:styles.button,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.icon,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPlus})}),/*#__PURE__*/_jsx(\"span\",{children:\"Add Nodes\"})]}),render:/*#__PURE__*/_jsx(Add,{})})]}),/*#__PURE__*/_jsx(\"div\",{className:styles.body,children:isLoading||nodesNumber.error||data.length===0?/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:styles.server,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faServer,size:\"2x\"})}),/*#__PURE__*/_jsx(\"div\",{className:styles.message,children:isLoading?'Retrieving keys...':nodesNumber.error?'An error occurred attempting to retrieve keys.':'No keys found for this contract.'})]}):data.map(function(node){return/*#__PURE__*/_jsxs(\"div\",{className:styles.node,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.left,children:[/*#__PURE__*/_jsx(\"span\",{className:styles.icon,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faServer})}),/*#__PURE__*/_jsxs(\"a\",{href:\"\".concat(network.explorerAddress,\"nodes/\").concat(node.code),target:\"_blank\",rel:\"noreferrer\",className:styles.link,children:[/*#__PURE__*/_jsx(\"span\",{className:styles.code,children:node.code}),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExternalLinkAlt})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.right,children:[node.status&&/*#__PURE__*/_jsxs(\"span\",{className:modifiable('status',[node.status.color],styles),children:[/*#__PURE__*/_jsx(\"span\",{className:styles.icon,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:node.status.color==='success'?faCheck:faTimes,size:\"sm\"})}),node.status.label]}),/*#__PURE__*/_jsxs(Dropdown,{children:[/*#__PURE__*/_jsxs(Dropdown.Toggle,{className:styles.toggle,children:[/*#__PURE__*/_jsx(\"span\",{children:\"Action\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.angle,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faAngleDown})})]}),/*#__PURE__*/_jsx(Dropdown.Menu,{className:styles.menu,children:actions.map(function(action){var disabled=!node.status.actions.includes(action.key);return/*#__PURE__*/_jsx(Dropdown.Item,{className:modifiable('action',[disabled&&'disabled'],styles),onClick:function onClick(event){event.preventDefault();onAct(action.callback(node.code));},children:action.label},action.key);})})]})]})]},node.code);})})]});};export default Nodes;","map":{"version":3,"sources":["/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/src/components/Nodes/index.tsx"],"names":["React","useEffect","useState","Fragment","transactionServices","faPlus","faServer","faTimes","faCheck","faExternalLinkAlt","faAngleDown","FontAwesomeIcon","Dropdown","Action","network","useGlobalContext","modifiable","useTransaction","Add","styles","Nodes","data","setData","nodesNumber","sendTransaction","useGetActiveTransactionsStatus","success","hasActiveTransactions","isLoading","status","variants","staked","label","color","actions","jailed","queued","unStaked","notStaked","key","callback","value","type","args","onAct","console","error","getNodes","length","calculateNodes","nodes","reduce","result","index","array","slice","code","item","Buffer","from","toString","refetchNodes","heading","title","button","icon","body","server","message","map","node","left","explorerAddress","link","right","toggle","angle","menu","action","disabled","includes","event","preventDefault"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { useEffect, useState, MouseEvent, Fragment } from 'react';\n\nimport { transactionServices } from '@elrondnetwork/dapp-core';\nimport {\n  faPlus,\n  faServer,\n  faTimes,\n  faCheck,\n  faExternalLinkAlt,\n  faAngleDown\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { Dropdown } from 'react-bootstrap';\n\nimport Action from 'components/Action';\nimport { network } from 'config';\nimport { useGlobalContext } from 'context';\nimport modifiable from 'helpers/modifiable';\n\nimport useTransaction from 'helpers/useTransaction';\n\nimport Add from './components/Add';\n\nimport styles from './styles.module.scss';\n\ninterface NodeType {\n  code: string;\n  status: any;\n}\n\ninterface VariantsType {\n  [key: string]: any;\n}\n\ninterface ArgumentsType {\n  value: string;\n  type: string;\n  args: string;\n}\n\ninterface ActionsType {\n  key: string;\n  label: string;\n  callback: (value: string) => ArgumentsType;\n}\n\nconst Nodes: React.FC = () => {\n  const [data, setData] = useState<Array<NodeType>>([]);\n  const { nodesNumber } = useGlobalContext();\n  const { sendTransaction } = useTransaction();\n  const { success, hasActiveTransactions } =\n    transactionServices.useGetActiveTransactionsStatus();\n\n  const isLoading = nodesNumber.status === 'loading';\n\n  const variants: VariantsType = {\n    staked: {\n      label: 'Staked',\n      color: 'success',\n      actions: ['unStake']\n    },\n    jailed: {\n      label: 'Jail',\n      color: 'danger',\n      actions: ['unJail']\n    },\n    queued: {\n      label: 'Queued',\n      color: 'warning',\n      actions: ['unStake']\n    },\n    unStaked: {\n      label: 'UnStaked',\n      color: 'warning',\n      actions: ['unBond', 'reStake']\n    },\n    notStaked: {\n      label: 'Inactive',\n      color: 'warning',\n      actions: ['stake', 'remove']\n    }\n  };\n\n  const actions: Array<ActionsType> = [\n    {\n      key: 'unStake',\n      label: 'Unstake',\n      callback: (value: string) => ({\n        value: '0',\n        type: 'unStakeNodes',\n        args: value\n      })\n    },\n    {\n      key: 'reStake',\n      label: 'ReStake',\n      callback: (value: string) => ({\n        value: '0',\n        type: 'reStakeUnStakedNodes',\n        args: value\n      })\n    },\n    {\n      key: 'unJail',\n      label: 'Unjail',\n      callback: (value: string) => ({\n        value: '2.5',\n        type: 'unJailNodes',\n        args: value\n      })\n    },\n    {\n      key: 'unBond',\n      label: 'Unbond',\n      callback: (value: string) => ({\n        value: '0',\n        type: 'unBondNodes',\n        args: value\n      })\n    },\n    {\n      key: 'stake',\n      label: 'Stake',\n      callback: (value: string) => ({\n        value: '0',\n        type: 'stakeNodes',\n        args: `${value}`\n      })\n    },\n    {\n      key: 'remove',\n      label: 'Remove',\n      callback: (value: string) => ({\n        value: '0',\n        type: 'removeNodes',\n        args: `${value}`\n      })\n    }\n  ];\n\n  const onAct = async ({ value, type, args }: ArgumentsType): Promise<void> => {\n    try {\n      await sendTransaction({\n        args,\n        type,\n        value\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  const getNodes = () => {\n    if (nodesNumber.data && nodesNumber.data.length > 0) {\n      const calculateNodes = (nodes: Array<any>) =>\n        nodes.reduce((result: any, value, index, array) => {\n          if (index % 2 === 0) {\n            const [code, status]: Array<any> = array.slice(index, index + 2);\n            const item = {\n              code: Buffer.from(code, 'base64').toString('hex'),\n              status: Buffer.from(status, 'base64').toString()\n            };\n\n            return [\n              ...result,\n              {\n                ...item,\n                status: variants[item.status]\n              }\n            ];\n          }\n          return result;\n        }, []);\n\n      setData(calculateNodes(nodesNumber.data));\n    }\n\n    return () => setData([]);\n  };\n\n  const refetchNodes = () => {\n    if (success && hasActiveTransactions && nodesNumber.data) {\n      getNodes();\n    }\n  };\n\n  useEffect(getNodes, [nodesNumber.data, success]);\n  useEffect(refetchNodes, [hasActiveTransactions, success]);\n\n  return (\n    <div className={styles.nodes}>\n      <div className={styles.heading}>\n        <span className={styles.title}>My Nodes</span>\n\n        <Action\n          title='Add Nodes'\n          trigger={\n            <div className={styles.button}>\n              <div className={styles.icon}>\n                <FontAwesomeIcon icon={faPlus} />\n              </div>\n              <span>Add Nodes</span>\n            </div>\n          }\n          render={<Add />}\n        />\n      </div>\n\n      <div className={styles.body}>\n        {isLoading || nodesNumber.error || data.length === 0 ? (\n          <Fragment>\n            <div className={styles.server}>\n              <FontAwesomeIcon icon={faServer} size='2x' />\n            </div>\n\n            <div className={styles.message}>\n              {isLoading\n                ? 'Retrieving keys...'\n                : nodesNumber.error\n                ? 'An error occurred attempting to retrieve keys.'\n                : 'No keys found for this contract.'}\n            </div>\n          </Fragment>\n        ) : (\n          data.map((node: NodeType) => (\n            <div key={node.code} className={styles.node}>\n              <div className={styles.left}>\n                <span className={styles.icon}>\n                  <FontAwesomeIcon icon={faServer} />\n                </span>\n\n                <a\n                  href={`${network.explorerAddress}nodes/${node.code}`}\n                  target='_blank'\n                  rel='noreferrer'\n                  className={styles.link}\n                >\n                  <span className={styles.code}>{node.code}</span>\n\n                  <FontAwesomeIcon icon={faExternalLinkAlt} />\n                </a>\n              </div>\n\n              <div className={styles.right}>\n                {node.status && (\n                  <span\n                    className={modifiable(\n                      'status',\n                      [node.status.color],\n                      styles\n                    )}\n                  >\n                    <span className={styles.icon}>\n                      <FontAwesomeIcon\n                        icon={\n                          node.status.color === 'success' ? faCheck : faTimes\n                        }\n                        size='sm'\n                      />\n                    </span>\n\n                    {node.status.label}\n                  </span>\n                )}\n\n                <Dropdown>\n                  <Dropdown.Toggle className={styles.toggle}>\n                    <span>Action</span>\n\n                    <div className={styles.angle}>\n                      <FontAwesomeIcon icon={faAngleDown} />\n                    </div>\n                  </Dropdown.Toggle>\n\n                  <Dropdown.Menu className={styles.menu}>\n                    {actions.map((action) => {\n                      const disabled = !node.status.actions.includes(\n                        action.key\n                      );\n\n                      return (\n                        <Dropdown.Item\n                          key={action.key}\n                          className={modifiable(\n                            'action',\n                            [disabled && 'disabled'],\n                            styles\n                          )}\n                          onClick={(event: MouseEvent) => {\n                            event.preventDefault();\n                            onAct(action.callback(node.code));\n                          }}\n                        >\n                          {action.label}\n                        </Dropdown.Item>\n                      );\n                    })}\n                  </Dropdown.Menu>\n                </Dropdown>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Nodes;\n"]},"metadata":{},"sourceType":"module"}