{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ediichim/Documents/workspace/temp/estar dapp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ediichim/Documents/workspace/temp/estar dapp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ediichim/Documents/workspace/temp/estar dapp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{transactionServices,refreshAccount}from'@elrondnetwork/dapp-core';import styles from'./styles.module.scss';import TxTracking from'../Layout/TxTracking';import{useGetAccountInfo}from'@elrondnetwork/dapp-core';import{Modal}from'react-bootstrap';import{io}from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Button=function Button(props){var navigate=useNavigate();var _useGetAccountInfo=useGetAccountInfo(),address=_useGetAccountInfo.address;var _TxTracking=TxTracking(),successfulTransactionsArray=_TxTracking.successfulTransactionsArray;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),setTransactionSessionId=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),session=_useState4[0],setSession=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),paid=_useState6[0],setPaid=_useState6[1];var sendTransactions=transactionServices.sendTransactions;var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),estar=_useState8[0],setEstar=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),egld=_useState10[0],setEgld=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),nft=_useState12[0],setNft=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),socket=_useState14[0],setSocket=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),show=_useState16[0],setShow=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),showSelect=_useState18[0],setShowSelect=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),success=_useState20[0],setSuccess=_useState20[1];var _useState21=useState(''),_useState22=_slicedToArray(_useState21,2),message=_useState22[0],setMessage=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),raceIsAv=_useState24[0],setRaceIsAv=_useState24[1];useEffect(function(){// Connect socket.io\nvar s=io('https://teste123.netlify.app:4000');s.emit('get-nfts',address);function handler(data){setNft(data);}s.on('recive-nfts',handler);setSocket(s);// Fee\nif(props.fee>0){setEstar(props.fee*100);setEgld(props.fee/200);}// Disconnect socket.io\nreturn function(){s.disconnect();};},[]);function available(){return _available.apply(this,arguments);}function _available(){_available=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var handler,av;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:handler=function handler(avOB){if(avOB.authorized){setRaceIsAv(avOB.isAvailable);setMessage('There are no more places available in this race!');}else{setMessage('You can only enter this race once!');}};_context4.next=3;return{id:props.id,address:address};case 3:av=_context4.sent;_context4.next=6;return socket.emit('get-available',av);case 6:_context4.next=8;return socket.on('recive-available',handler);case 8:setShow(true);case 9:case\"end\":return _context4.stop();}}},_callee4);}));return _available.apply(this,arguments);};useEffect(function(){for(var i=0;i<successfulTransactionsArray.length;i++){if(successfulTransactionsArray[i][0]==session){setPaid(true);}}},[successfulTransactionsArray]);useEffect(function(){if(paid)setShowSelect(true);},[paid]);var encrypt=function encrypt(){return(estar*100).toString(16);};var sendEstarTransaction=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var estarTransaction,_yield$sendTransactio,sessionId;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:estarTransaction={value:0,gasLimit:'500000',data:estar>=50&&estar<=656?btoa('ESDTTransfer@45535441522d616661616630@'+encrypt()):btoa('ESDTTransfer@45535441522d616661616630@0'+encrypt()),receiver:'erd1q07w9xm8avd7kwj3cgn3xrnhzg5da7e3vg7dv6gs3npyql0jpq9ss35a20'};_context.next=3;return refreshAccount();case 3:_context.next=5;return sendTransactions({transactions:estarTransaction,transactionsDisplayInfo:{processingMessage:'Processing transaction',errorMessage:'An error has occured during',successMessage:'Transaction successful'},redirectAfterSign:false});case 5:_yield$sendTransactio=_context.sent;sessionId=_yield$sendTransactio.sessionId;if(sessionId!=null){setTransactionSessionId(sessionId);setSession(sessionId);}case 8:case\"end\":return _context.stop();}}},_callee);}));return function sendEstarTransaction(){return _ref.apply(this,arguments);};}();var sendEgldTransaction=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var egldTransaction,_yield$sendTransactio2,sessionId;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:egldTransaction={value:egld?egld*1000000000000000000:0,gasLimit:'70000',data:'QG9r',receiver:'erd1q07w9xm8avd7kwj3cgn3xrnhzg5da7e3vg7dv6gs3npyql0jpq9ss35a20'};_context2.next=3;return refreshAccount();case 3:_context2.next=5;return sendTransactions({transactions:egldTransaction,transactionsDisplayInfo:{processingMessage:'Processing transaction',errorMessage:'An error has occured during',successMessage:'Transaction successful'},redirectAfterSign:true});case 5:_yield$sendTransactio2=_context2.sent;sessionId=_yield$sendTransactio2.sessionId;if(sessionId!=null){setTransactionSessionId(sessionId);setSession(sessionId);}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function sendEgldTransaction(){return _ref2.apply(this,arguments);};}();var enter=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(horse){var data,test;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return{address:address,horse:horse,feePaid:true,raceId:props.id};case 2:data=_context3.sent;socket.emit('enter-race',data);test=function test(response){setSuccess(true);setShowSelect(response.showb);setMessage(response.message);};socket.on('recive-response',test);case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function enter(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"button\",{className:props.className?props.className+' '+styles.btn:styles.btn,style:{backgroundColor:props.color},onClick:available,children:props.name}),/*#__PURE__*/_jsxs(Modal,{dialogClassName:\"custom-dialog\",show:show,onHide:function onHide(){return setShow(!show);},\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,className:\"bg-white\",children:raceIsAv?/*#__PURE__*/_jsx(Modal.Title,{children:\"Pay with\"}):/*#__PURE__*/_jsx(Modal.Title,{children:\"Slots\"})}),/*#__PURE__*/_jsx(Modal.Body,{className:\"bg-white w-100\",children:raceIsAv?/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"d-block mx-auto btn btn-primary\",onClick:function onClick(){setShow(false);sendEstarTransaction();},children:[estar,\" eStar\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"d-block mx-auto btn btn-primary ml-2\",onClick:function onClick(){sendEgldTransaction();setShow(false);},children:[egld,\" eGld\"]})]}):/*#__PURE__*/_jsx(\"h5\",{children:message})})]}),/*#__PURE__*/_jsxs(Modal,{show:showSelect,size:\"xl\",backdrop:\"static\",keyboard:false,onHide:function onHide(){return setShowSelect(false);},\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{className:\"bg-white\",children:/*#__PURE__*/_jsx(Modal.Title,{id:\"contained-modal-title-vcenter\",children:\"Select Horse\"})}),/*#__PURE__*/_jsx(Modal.Body,{className:\"bg-white px-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:nft?nft.map(function(_ref4){var fileUri=_ref4.fileUri,name=_ref4.name,stamina=_ref4.stamina;if(stamina>=25){return/*#__PURE__*/_jsxs(\"div\",{className:\"col-12 col-md-4 text-center\",onClick:function onClick(){return enter(name);},children:[/*#__PURE__*/_jsx(\"img\",{src:fileUri,className:\"d-block mx-auto\",height:\"250px\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'black'},children:name}),props.id>1?'':stamina==25&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-danger\",children:[\"Stamina: \",stamina]})||stamina==50&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-warning\",children:[\"Stamina: \",stamina]})||stamina>50&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-primary\",children:[\"Stamina: \",stamina]})]},name);}}):/*#__PURE__*/_jsx(\"p\",{children:\"You don't have EquiStar Nfts.\"})})})]}),/*#__PURE__*/_jsxs(Modal,{show:success,backdrop:\"static\",keyboard:false,size:\"md-down\",onHide:function onHide(){return setSuccess(false);},\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{className:\"bg-white\",children:/*#__PURE__*/_jsx(Modal.Title,{id:\"contained-modal-title-vcenter\",children:\"\\uD83C\\uDF89 Congratulations!\"})}),/*#__PURE__*/_jsx(Modal.Body,{className:\"bg-white px-3\",children:/*#__PURE__*/_jsx(\"h4\",{children:message})}),/*#__PURE__*/_jsx(Modal.Footer,{className:\"bg-white\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary d-block mx-auto\",onClick:function onClick(){return navigate('/');},children:\"Close\"})})]})]});};export default Button;","map":{"version":3,"sources":["/Users/ediichim/Documents/workspace/temp/estar dapp/client/src/components/Button/index.js"],"names":["React","useState","useEffect","useNavigate","transactionServices","refreshAccount","styles","TxTracking","useGetAccountInfo","Modal","io","Button","props","navigate","address","successfulTransactionsArray","setTransactionSessionId","session","setSession","paid","setPaid","sendTransactions","estar","setEstar","egld","setEgld","nft","setNft","socket","setSocket","show","setShow","showSelect","setShowSelect","success","setSuccess","message","setMessage","raceIsAv","setRaceIsAv","s","emit","handler","data","on","fee","disconnect","available","avOB","authorized","isAvailable","id","av","i","length","encrypt","toString","sendEstarTransaction","estarTransaction","value","gasLimit","btoa","receiver","transactions","transactionsDisplayInfo","processingMessage","errorMessage","successMessage","redirectAfterSign","sessionId","sendEgldTransaction","egldTransaction","enter","horse","feePaid","raceId","test","response","showb","className","btn","backgroundColor","color","name","map","fileUri","stamina"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { transactionServices, refreshAccount } from '@elrondnetwork/dapp-core';\nimport styles from './styles.module.scss';\nimport TxTracking from '../Layout/TxTracking';\nimport { useGetAccountInfo } from '@elrondnetwork/dapp-core';\nimport { Modal } from 'react-bootstrap';\nimport { io } from 'socket.io-client';\n\nconst Button = (props) => {\n  const navigate = useNavigate();\n  const { address } = useGetAccountInfo();\n  const { successfulTransactionsArray } = TxTracking();\n  const [, setTransactionSessionId] = useState('');\n  const [session, setSession] = useState('');\n  const [paid, setPaid] = useState(false);\n  const { sendTransactions } = transactionServices;\n  const [estar, setEstar] = useState(0);\n  const [egld, setEgld] = useState(0);\n  const [nft, setNft] = useState([]);\n  const [socket, setSocket] = useState();\n  const [show, setShow] = useState(false);\n  const [showSelect, setShowSelect] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [message, setMessage] = useState('');\n  const [raceIsAv, setRaceIsAv] = useState(false);\n\n  useEffect(() => {\n    // Connect socket.io\n    const s = io('https://teste123.netlify.app:4000');\n    s.emit('get-nfts', address);\n    function handler (data) {\n      setNft(data);\n    }\n    s.on('recive-nfts', handler);\n    setSocket(s);\n\n    // Fee\n    if (props.fee > 0) {\n      setEstar(props.fee * 100);\n      setEgld(props.fee / 200);\n    }\n    // Disconnect socket.io\n    return () => {\n      s.disconnect();\n    };\n  }, []);\n\n  async function available () {\n    const handler = (avOB) => {\n      if(avOB.authorized) {\n        setRaceIsAv(avOB.isAvailable);\n        setMessage('There are no more places available in this race!')\n      } else {\n        setMessage('You can only enter this race once!');\n      }\n    };\n    const av = await {\n      id: props.id,\n      address: address,\n    };\n    await socket.emit('get-available', av);\n    await socket.on('recive-available', handler);\n    setShow(true);\n  };\n\n  useEffect(() => {\n    for (let i = 0; i < successfulTransactionsArray.length; i++) {\n      if (successfulTransactionsArray[i][0] == session) {\n        setPaid(true);\n      }\n    }\n  }, [successfulTransactionsArray]);\n\n  useEffect(() => {\n    if(paid) setShowSelect(true);\n  }, [paid])\n\n  const encrypt = () => {\n    return (estar * 100).toString(16);\n  };\n\n  const sendEstarTransaction = async () => {\n    const estarTransaction = {\n      value: 0,\n      gasLimit: '500000',\n      data:\n        estar >= 50 && estar <= 656\n          ? btoa('ESDTTransfer@45535441522d616661616630@' + encrypt())\n          : btoa('ESDTTransfer@45535441522d616661616630@0' + encrypt()),\n      receiver: 'erd1q07w9xm8avd7kwj3cgn3xrnhzg5da7e3vg7dv6gs3npyql0jpq9ss35a20'\n    };\n    await refreshAccount();\n\n    const { sessionId } = await sendTransactions({\n      transactions: estarTransaction,\n      transactionsDisplayInfo: {\n        processingMessage: 'Processing transaction',\n        errorMessage: 'An error has occured during',\n        successMessage: 'Transaction successful'\n      },\n      redirectAfterSign: false\n    });\n    if (sessionId != null) {\n      setTransactionSessionId(sessionId);\n      setSession(sessionId);\n    }\n  };\n\n  const sendEgldTransaction = async () => {\n    const egldTransaction = {\n      value: egld ? egld * 1000000000000000000 : 0,\n      gasLimit: '70000',\n      data: 'QG9r',\n      receiver: 'erd1q07w9xm8avd7kwj3cgn3xrnhzg5da7e3vg7dv6gs3npyql0jpq9ss35a20'\n    };\n    await refreshAccount();\n\n    const { sessionId } = await sendTransactions({\n      transactions: egldTransaction,\n      transactionsDisplayInfo: {\n        processingMessage: 'Processing transaction',\n        errorMessage: 'An error has occured during',\n        successMessage: 'Transaction successful'\n      },\n      redirectAfterSign: true\n    });\n    if (sessionId != null) {\n      setTransactionSessionId(sessionId);\n      setSession(sessionId);\n    }\n  };\n\n  const enter = async (horse) => {\n    const data = await {\n        address: address,\n        horse: horse,\n        feePaid: true,\n        raceId: props.id,\n      };\n    socket.emit('enter-race', data);\n    const test = (response) => {\n        setSuccess(true);\n        setShowSelect(response.showb);\n        setMessage(response.message);\n      }\n\n      socket.on('recive-response', test);\n  };\n\n  return (\n    <div className='container'>\n      <button\n        className={props.className ? props.className + ' ' + styles.btn : styles.btn}\n        style={{ backgroundColor: props.color }}\n        onClick={available}\n      >\n        {props.name}\n      </button>\n      {/* Enter race modal */}\n      <Modal\n        dialogClassName='custom-dialog'\n        show={show}\n        onHide={() => setShow(!show)}\n        aria-labelledby='contained-modal-title-vcenter'\n        centered\n      >\n        <Modal.Header closeButton className='bg-white'>\n          {raceIsAv ? (\n            <Modal.Title>Pay with</Modal.Title>\n          ) : (\n            <Modal.Title>Slots</Modal.Title>\n          )}\n        </Modal.Header>\n\n        <Modal.Body className='bg-white w-100'>\n          {raceIsAv ? (\n            <div className='d-flex'>\n              <button\n                className='d-block mx-auto btn btn-primary'\n                onClick={() => {\n                  setShow(false);\n                  sendEstarTransaction();\n                }}\n              >\n                {estar} eStar\n              </button>\n              <button\n                className='d-block mx-auto btn btn-primary ml-2'\n                onClick={() => {\n                  sendEgldTransaction();\n                  setShow(false);\n                }}\n              >\n                {egld} eGld\n              </button>\n            </div>\n          ) : (\n            <h5>{message}</h5>\n          )}\n        </Modal.Body>\n      </Modal>\n      <Modal\n        show={showSelect}\n        size='xl'\n        backdrop='static'\n        keyboard={false}\n        onHide={() => setShowSelect(false)}\n        aria-labelledby='contained-modal-title-vcenter'\n        centered\n      >\n        <Modal.Header className='bg-white'>\n          <Modal.Title id='contained-modal-title-vcenter'>\n            Select Horse\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body className='bg-white px-0'>\n            <div className='row'>\n              {nft ? (\n                nft.map(({ fileUri, name, stamina }) => {\n                  if(stamina >= 25) {\n                    return (\n                      <div\n                        key={name}\n                        className='col-12 col-md-4 text-center'\n                        onClick={() => enter(name)}\n                      >\n                        <img src={fileUri} className='d-block mx-auto' height='250px' />\n                        <p style={{ color: 'black' }}>{name}</p>\n                        {props.id > 1 ? '' : stamina == 25 && <p className='text-danger'>Stamina: {stamina}</p> ||\n                          stamina == 50 && <p className='text-warning'>Stamina: {stamina}</p> ||\n                          stamina > 50 && <p className='text-primary'>Stamina: {stamina}</p>\n                        }\n                      </div>\n                    );\n                  }\n                })\n              ) : (\n                <p>You don&apos;t have EquiStar Nfts.</p>\n              )}\n            </div>\n        </Modal.Body>\n      </Modal>\n      <Modal\n        show={success}\n        backdrop='static'\n        keyboard={false}\n        size='md-down'\n        onHide={() => setSuccess(false)}\n        aria-labelledby='contained-modal-title-vcenter'\n        centered\n      >\n        <Modal.Header className='bg-white'>\n          <Modal.Title id='contained-modal-title-vcenter'>\n            🎉 Congratulations!\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body className='bg-white px-3'>\n            <h4>{message}</h4>\n        </Modal.Body>\n        <Modal.Footer className='bg-white'>\n            <button\n              className='btn btn-primary d-block mx-auto'\n              onClick={() => navigate('/')}\n            >\n              Close\n            </button>\n        </Modal.Footer>\n      </Modal>\n    </div>\n  );\n};\n\nexport default Button;\n"]},"metadata":{},"sourceType":"module"}