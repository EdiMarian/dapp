{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as React from'react';import{useState,useEffect}from'react';import{faMinus}from'@fortawesome/free-solid-svg-icons';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import axios from'axios';import moment from'moment';import Logo from'assets/Logo';import{network}from'config';import modifiable from'helpers/modifiable';import useTransaction from'helpers/useTransaction';import styles from'./styles.module.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Withdrawal=function Withdrawal(_ref){var value=_ref.value,timeLeft=_ref.timeLeft;var _useState=useState(timeLeft-moment().unix()),_useState2=_slicedToArray(_useState,2),counter=_useState2[0],setCounter=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),fiat=_useState4[0],setFiat=_useState4[1];var _useTransaction=useTransaction(),sendTransaction=_useTransaction.sendTransaction;var getTimeLeft=function getTimeLeft(){var duration=moment.duration(counter,'seconds');var formatters={d:[duration.asDays(),Math.floor(duration.asDays())],h:[duration.asHours(),'H'],m:[duration.asMinutes(),'m'],s:[duration.asSeconds(),'s']};var format=Object.keys(formatters).reduce(function(total,key){var _formatters$key=_slicedToArray(formatters[key],2),time=_formatters$key[0],label=_formatters$key[1];if(Math.floor(time)>0){return total===''?\"\".concat(label,\"[\").concat(key,\"]\"):\"\".concat(total,\" : \").concat(label,\"[\").concat(key,\"]\");}return total;},'');return moment.utc(moment.duration(counter,'seconds').asMilliseconds()).format(format);};var onWithdraw=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return sendTransaction({args:'',type:'withdraw',value:'0'});case 3:_context.next=8;break;case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 8:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}));return function onWithdraw(){return _ref2.apply(this,arguments);};}();var fetchFiat=function fetchFiat(){var source=axios.CancelToken.source();var fetchData=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var pairs,token,amount;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.get('https://api.elrond.com/mex-pairs',{cancelToken:source.token});case 3:pairs=_context2.sent;token=pairs.data.find(function(item){return item.baseId==='WEGLD-bd4d79';});amount=parseFloat(value.replace(',',''))*token.basePrice;setFiat(Number(amount.toFixed(2)).toLocaleString());_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);if(!axios.isCancel(_context2.t0)){_context2.next=13;break;}return _context2.abrupt(\"return\");case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function fetchData(){return _ref3.apply(this,arguments);};}();fetchData();return function(){setFiat('');source.cancel();};};var handleCounter=function handleCounter(){var interval=setInterval(function(){return setCounter(function(timer){return timer-1;});},1000);return function(){clearInterval(interval);setCounter(timeLeft-moment().unix());};};useEffect(handleCounter,[]);useEffect(fetchFiat,[]);return/*#__PURE__*/_jsxs(\"div\",{className:styles.withdrawal,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.left,children:[/*#__PURE__*/_jsx(\"span\",{className:styles.icon,children:/*#__PURE__*/_jsx(Logo,{})}),/*#__PURE__*/_jsxs(\"div\",{className:styles.data,children:[/*#__PURE__*/_jsxs(\"span\",{className:styles.value,children:[value,\" \",network.egldLabel]}),/*#__PURE__*/_jsxs(\"span\",{className:styles.amount,children:[\"$\",fiat]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.right,children:[counter>0&&/*#__PURE__*/_jsxs(\"div\",{className:styles.time,children:[/*#__PURE__*/_jsx(\"span\",{className:styles.date,children:getTimeLeft()}),/*#__PURE__*/_jsx(\"span\",{className:styles.label,children:\"Wait Time Left\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:onWithdraw,className:modifiable('withdraw',[counter>0&&'disabled'],styles),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMinus}),\" \",/*#__PURE__*/_jsx(\"span\",{children:\"Withdraw\"})]})]}),counter>0&&/*#__PURE__*/_jsxs(\"div\",{className:modifiable('time',['mobile'],styles),children:[/*#__PURE__*/_jsx(\"span\",{className:styles.date,children:getTimeLeft()}),/*#__PURE__*/_jsx(\"span\",{className:styles.label,children:\"Wait Time Left\"})]})]});};export default Withdrawal;","map":{"version":3,"sources":["/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/src/components/Withdrawals/components/Withdrawal/index.tsx"],"names":["React","useState","useEffect","faMinus","FontAwesomeIcon","axios","moment","Logo","network","modifiable","useTransaction","styles","Withdrawal","value","timeLeft","unix","counter","setCounter","fiat","setFiat","sendTransaction","getTimeLeft","duration","formatters","d","asDays","Math","floor","h","asHours","m","asMinutes","s","asSeconds","format","Object","keys","reduce","total","key","time","label","utc","asMilliseconds","onWithdraw","args","type","console","error","fetchFiat","source","CancelToken","fetchData","get","cancelToken","token","pairs","data","find","item","baseId","amount","parseFloat","replace","basePrice","Number","toFixed","toLocaleString","isCancel","cancel","handleCounter","interval","setInterval","timer","clearInterval","withdrawal","left","icon","egldLabel","right","date"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { useState, useEffect } from 'react';\n\nimport { faMinus } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport axios from 'axios';\n\nimport moment from 'moment';\nimport Logo from 'assets/Logo';\nimport { network } from 'config';\nimport { UndelegateStakeListType } from 'context/state';\nimport modifiable from 'helpers/modifiable';\nimport useTransaction from 'helpers/useTransaction';\n\nimport styles from './styles.module.scss';\n\ninterface FormattersType {\n  [key: string]: any;\n  d: Array<string | number>;\n  h: Array<string | number>;\n  m: Array<string | number>;\n  s: Array<string | number>;\n}\n\nconst Withdrawal: React.FC<UndelegateStakeListType> = ({ value, timeLeft }) => {\n  const [counter, setCounter] = useState<number>(timeLeft - moment().unix());\n  const [fiat, setFiat] = useState<string>('');\n  const { sendTransaction } = useTransaction();\n\n  const getTimeLeft = (): string => {\n    const duration = moment.duration(counter, 'seconds');\n    const formatters: FormattersType = {\n      d: [duration.asDays(), Math.floor(duration.asDays())],\n      h: [duration.asHours(), 'H'],\n      m: [duration.asMinutes(), 'm'],\n      s: [duration.asSeconds(), 's']\n    };\n\n    const format = Object.keys(formatters).reduce((total, key) => {\n      const [time, label] = formatters[key];\n\n      if (Math.floor(time) > 0) {\n        return total === ''\n          ? `${label}[${key}]`\n          : `${total} : ${label}[${key}]`;\n      }\n\n      return total;\n    }, '');\n\n    return moment\n      .utc(moment.duration(counter, 'seconds').asMilliseconds())\n      .format(format);\n  };\n\n  const onWithdraw = async (): Promise<void> => {\n    try {\n      await sendTransaction({\n        args: '',\n        type: 'withdraw',\n        value: '0'\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  const fetchFiat = () => {\n    const source = axios.CancelToken.source();\n\n    const fetchData = async () => {\n      try {\n        const pairs = await axios.get('https://api.elrond.com/mex-pairs', {\n          cancelToken: source.token\n        });\n\n        const token = pairs.data.find(\n          (item: any) => item.baseId === 'WEGLD-bd4d79'\n        );\n\n        const amount = parseFloat(value.replace(',', '')) * token.basePrice;\n\n        setFiat(Number(amount.toFixed(2)).toLocaleString());\n      } catch (error) {\n        if (axios.isCancel(error)) {\n          return;\n        }\n      }\n    };\n\n    fetchData();\n\n    return () => {\n      setFiat('');\n      source.cancel();\n    };\n  };\n\n  const handleCounter = () => {\n    const interval = setInterval(() => setCounter((timer) => timer - 1), 1000);\n\n    return () => {\n      clearInterval(interval);\n      setCounter(timeLeft - moment().unix());\n    };\n  };\n\n  useEffect(handleCounter, []);\n  useEffect(fetchFiat, []);\n\n  return (\n    <div className={styles.withdrawal}>\n      <div className={styles.left}>\n        <span className={styles.icon}>\n          <Logo />\n        </span>\n\n        <div className={styles.data}>\n          <span className={styles.value}>\n            {value} {network.egldLabel}\n          </span>\n\n          <span className={styles.amount}>${fiat}</span>\n        </div>\n      </div>\n      <div className={styles.right}>\n        {counter > 0 && (\n          <div className={styles.time}>\n            <span className={styles.date}>{getTimeLeft()}</span>\n            <span className={styles.label}>Wait Time Left</span>\n          </div>\n        )}\n\n        <button\n          onClick={onWithdraw}\n          className={modifiable(\n            'withdraw',\n            [counter > 0 && 'disabled'],\n            styles\n          )}\n        >\n          <FontAwesomeIcon icon={faMinus} /> <span>Withdraw</span>\n        </button>\n      </div>\n\n      {counter > 0 && (\n        <div className={modifiable('time', ['mobile'], styles)}>\n          <span className={styles.date}>{getTimeLeft()}</span>\n          <span className={styles.label}>Wait Time Left</span>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Withdrawal;\n"]},"metadata":{},"sourceType":"module"}