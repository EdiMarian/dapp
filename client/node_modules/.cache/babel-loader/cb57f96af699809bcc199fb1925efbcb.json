{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as React from'react';import{useState,useEffect}from'react';import{BLS}from'@elrondnetwork/erdjs';import{faKey,faTimes}from'@fortawesome/free-solid-svg-icons';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{useFormikContext}from'formik';import moment from'moment';import{useDropzone}from'react-dropzone';import{network}from'config';import modifiable from'helpers/modifiable';import decodeFile from'./helpers';import styles from'./styles.module.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Dropzone=function Dropzone(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var _useFormikContext=useFormikContext(),setFieldValue=_useFormikContext.setFieldValue,values=_useFormikContext.values;var readFile=function readFile(file){return new Promise(function(resolve){var fileReader=new FileReader();var defaults={name:file.name,key:\"\".concat(file.name,\"-\").concat(moment().unix())};fileReader.onload=function(){try{var result=fileReader.result;var contract=network.delegationContract;var decoded=decodeFile(result,contract);resolve(_objectSpread(_objectSpread({},decoded),defaults));}catch(error){resolve(defaults);}};fileReader.onError=function(){resolve(defaults);};fileReader.readAsText(file);});};var dropzone=useDropzone({multiple:true,accept:'.pem',onDrop:function(){var _onDrop=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(files){var readers,items;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return BLS.initIfNecessary();case 3:readers=files.map(readFile);_context.next=6;return Promise.all(readers);case 6:items=_context.sent;setData(function(previous){return[].concat(_toConsumableArray(previous),_toConsumableArray(items));});_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));function onDrop(_x){return _onDrop.apply(this,arguments);}return onDrop;}()});var properties={input:dropzone.getInputProps(),root:dropzone.getRootProps({className:modifiable('dropzone',[values.files.length>0&&'filled'],styles),style:{cursor:'pointer'}})};var onRemove=function onRemove(key){var filter=function filter(item){return item.key!==key;};setData(function(current){return current.filter(filter);});setFieldValue('files',values.files.filter(filter));};var setValue=function setValue(){var value=data.map(function(file,fileIndex){var errors=[];var duplicate=function duplicate(item,itemIndex){return file.pubKey===item.pubKey&&fileIndex>itemIndex;};if(!file.pubKey||file.pubKey.length!==192){errors.push('length');}if(data.find(duplicate)){errors.push('unique');}return _objectSpread(_objectSpread({},file),{},{errors:errors});});setFieldValue('files',value);return function(){return setFieldValue('files',[]);};};useEffect(setValue,[data]);return/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread({},properties.root),{},{children:[/*#__PURE__*/_jsx(\"input\",_objectSpread({},properties.input)),values.files.length>0?values.files.map(function(file){return/*#__PURE__*/_jsxs(\"div\",{className:modifiable('file',[file.errors&&file.errors.length>0&&'error'],styles),children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.meta,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faKey}),/*#__PURE__*/_jsx(\"span\",{className:styles.name,children:file.name})]}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(event){event.preventDefault();event.stopPropagation();onRemove(file.key);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes})})]},file.key);}):/*#__PURE__*/_jsx(\"span\",{className:styles.message,children:\"Drag and drop your PEM Files here, or Select Files\"})]}));};export default Dropzone;","map":{"version":3,"sources":["/Users/ediichim/Documents/workspace/temp/delegation-dashboard.elrond.com/src/components/Nodes/components/Dropzone/index.tsx"],"names":["React","useState","useEffect","BLS","faKey","faTimes","FontAwesomeIcon","useFormikContext","moment","useDropzone","network","modifiable","decodeFile","styles","Dropzone","data","setData","setFieldValue","values","readFile","file","Promise","resolve","fileReader","FileReader","defaults","name","key","unix","onload","result","contract","delegationContract","decoded","error","onError","readAsText","dropzone","multiple","accept","onDrop","files","initIfNecessary","readers","map","all","items","previous","console","properties","input","getInputProps","root","getRootProps","className","length","style","cursor","onRemove","filter","item","current","setValue","value","fileIndex","errors","duplicate","itemIndex","pubKey","push","find","meta","event","preventDefault","stopPropagation","message"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { useState, useEffect } from 'react';\n\nimport { BLS } from '@elrondnetwork/erdjs';\nimport { faKey, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { useFormikContext, FormikProps } from 'formik';\nimport moment from 'moment';\nimport { useDropzone } from 'react-dropzone';\n\nimport { network } from 'config';\nimport modifiable from 'helpers/modifiable';\nimport decodeFile from './helpers';\n\nimport styles from './styles.module.scss';\nexport interface DropzoneFormType {\n  files: Array<any>;\n}\n\nexport interface DropzonePayloadType {\n  key: string;\n  name: string;\n  signature: string;\n  pubKey: string;\n  value: Array<Uint8Array>;\n  errors?: Array<string>;\n}\n\nconst Dropzone: React.FC = () => {\n  const [data, setData] = useState<Array<DropzonePayloadType>>([]);\n  const { setFieldValue, values }: FormikProps<DropzoneFormType> =\n    useFormikContext();\n\n  const readFile = (file: any) =>\n    new Promise((resolve) => {\n      const fileReader: any = new FileReader();\n      const defaults = {\n        name: file.name,\n        key: `${file.name}-${moment().unix()}`\n      };\n\n      fileReader.onload = () => {\n        try {\n          const result = fileReader.result;\n          const contract = network.delegationContract;\n          const decoded = decodeFile(result, contract);\n\n          resolve({\n            ...decoded,\n            ...defaults\n          });\n        } catch (error) {\n          resolve(defaults);\n        }\n      };\n\n      fileReader.onError = () => {\n        resolve(defaults);\n      };\n\n      fileReader.readAsText(file);\n    });\n\n  const dropzone = useDropzone({\n    multiple: true,\n    accept: '.pem',\n    onDrop: async (files: any) => {\n      try {\n        await BLS.initIfNecessary();\n\n        const readers = files.map(readFile);\n        const items = await Promise.all(readers);\n\n        setData((previous: any) => [...previous, ...items]);\n      } catch (error) {\n        console.error(error);\n      }\n    }\n  });\n\n  const properties = {\n    input: dropzone.getInputProps(),\n    root: dropzone.getRootProps({\n      className: modifiable(\n        'dropzone',\n        [values.files.length > 0 && 'filled'],\n        styles\n      ),\n      style: {\n        cursor: 'pointer'\n      }\n    })\n  };\n\n  const onRemove = (key: string) => {\n    const filter = (item: DropzonePayloadType) => item.key !== key;\n\n    setData((current: Array<DropzonePayloadType>) => current.filter(filter));\n    setFieldValue('files', values.files.filter(filter));\n  };\n\n  const setValue = () => {\n    const value = data.map((file: DropzonePayloadType, fileIndex: number) => {\n      const errors: Array<string> = [];\n      const duplicate = (item: DropzonePayloadType, itemIndex: number) =>\n        file.pubKey === item.pubKey && fileIndex > itemIndex;\n\n      if (!file.pubKey || file.pubKey.length !== 192) {\n        errors.push('length');\n      }\n\n      if (data.find(duplicate)) {\n        errors.push('unique');\n      }\n\n      return {\n        ...file,\n        errors\n      };\n    });\n\n    setFieldValue('files', value);\n\n    return () => setFieldValue('files', []);\n  };\n\n  useEffect(setValue, [data]);\n\n  return (\n    <div {...properties.root}>\n      <input {...properties.input} />\n\n      {values.files.length > 0 ? (\n        values.files.map((file: DropzonePayloadType) => (\n          <div\n            key={file.key}\n            className={modifiable(\n              'file',\n              [file.errors && file.errors.length > 0 && 'error'],\n              styles\n            )}\n          >\n            <div className={styles.meta}>\n              <FontAwesomeIcon icon={faKey} />\n\n              <span className={styles.name}>{file.name}</span>\n            </div>\n\n            <span\n              onClick={(event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                onRemove(file.key);\n              }}\n            >\n              <FontAwesomeIcon icon={faTimes} />\n            </span>\n          </div>\n        ))\n      ) : (\n        <span className={styles.message}>\n          Drag and drop your PEM Files here, or Select Files\n        </span>\n      )}\n    </div>\n  );\n};\n\nexport default Dropzone;\n"]},"metadata":{},"sourceType":"module"}